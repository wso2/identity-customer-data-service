# -------------------------------------------------------------------------------------
#
# Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com).
#
# WSO2 LLC. licenses this file to you under the Apache License,
# Version 2.0 (the "License"); you may not use this file except
# in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied. See the License for the
# specific language governing permissions and limitations
# under the License.
#
# --------------------------------------------------------------------------------------


cloud:
  deployment:
    cds:
      containerPort: 8080 # TODO: Update to the port the CDS server listens on
      config: #TODO: Update all the values as required in the config section. The default values have been taken from the sample deployment.yaml in the repo.
        env: "dev"
        logLevel: "INFO" # Log level: "INFO", "WARN", "ERROR", "DEBUG"
        cache:
          enabled: true
          defaultCacheTimeout: 15
        auth:
          corsAllowedOrigins: # TODO: Update the allowed CORS origins as needed
            - "http://localhost:3000"
            - "http://localhost:3001"
            - "https://localhost:9001"
        addr:
          host: "cds.local.com"
        sync:
          schema:
            enabled: true
            interval: 3600 # in seconds
        datasource:
          type: "postgres"
          hostname: "localhost"
          port: 5432
          name: "iam_cds"
          sslmode: "enable"
        identityServer:
          serviceName: identity-service
          servicePort: 9443
          introspectionEndpoint: "/oauth2/introspect"
          tokenEndpoint: "/oauth2/token"
          revocationEndpoint: "/oauth2/revoke"
          claimsEndpoint: "api/server/v1/claim-dialects"
      secrets:
        authServerClientId: "" # Add the auth server client ID
        authServerClientSecret: "" # Add the auth server client secret
        authServerAdminUsername: "" # Add the auth server admin username
        authServerAdminPassword: "" # Add the auth server admin password
        databaseAdminUsername: "" # Add the database admin username
        databaseAdminPassword: "" # Add the database admin password
      replicas: 2
      annotations: {} # TODO: Check if the annotation works when overridden from the pipeline.
      progressDeadlineSeconds: 300
      minReadySeconds: 30
      strategy:
        rollingUpdate:
          maxSurge: 1
          maxUnavailable: 0
      dockerRegistry: ""
      imageName: ""
      digest: ""
      livenessProbe:
        initialDelaySeconds: 20
        periodSeconds: 10
      readinessProbe:
        initialDelaySeconds: 20
        periodSeconds: 10
      imagePullPolicy: Always
      resources:
        requests:
          memory: #TODO: Update as needed by the application
          cpu: #TODO: Update as needed by the application
        limits:
          memory: #TODO: Update as needed by the application
          cpu: #TODO: Update as needed by the application
      hpa:
        maxReplicas: 3
        averageUtilizationCPU: 75
        averageUtilizationMemory: 75

  service:
    name: cds-service
    port: 8080 # TODO: Update to the port the CDS server should be exposed on. Can be equal to the container port.
  ingress:
    ratelimit:
      cds:
        zoneName: "cds"
        burstLimit: 50
    hostName: "cds.local.com"
    ingressClassName: "nginx"
