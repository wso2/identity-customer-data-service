---
title: Integration Testing Guide
date: 2025-05-21
---

# ğŸ§ª Testing Guide â€” Identity Customer Data Service

This guide explains how to run, manage, and report integration tests in the `identity-customer-data-service` project using Go, Testcontainers, and standard tooling.

---

##  Prerequisites

1. **Install Go** (v1.20+ recommended)  
2. **Install Docker** (with CLI access)  

---

##  Test Directory Structure

```
/test
  â””â”€â”€ integration
      â”œâ”€â”€ profile_schema_test.go
      â”œâ”€â”€ profile_test.go
      â”œâ”€â”€ unification_rules_test.go
      â”œâ”€â”€ setup/
      â”‚    â””â”€â”€ schema.sql
      â””â”€â”€ utils/
           â””â”€â”€ ...
```

---

##  Test Setup Overview

Tests use **Testcontainers-Go** to spin up a Postgres container and initialize the schema from `test/setup/schema.sql`.

- Containers are terminated explicitly at the end.
- `TESTCONTAINERS_RYUK_DISABLED=true` is used to avoid lifecycle issues.

---

## ğŸ§ª Running Tests

### Run All Tests

```bash
make integration-test
```

Logs are stored in:

```
target/integration-test.log
```

### Run a Specific Test

```bash
make integration-test test=Test_ProfilesService
```

---

## âœ… Test Suite Summary

| Test Suite             | Sub-Test Name             | Description                            | Status  |
|------------------------|---------------------------|----------------------------------------|---------|
| `Test_Profiles`        | Create_profile_via_event  | Creates profile from event ingestion   | âœ… Pass |
|                        | Fetch_created_profile     | Retrieves created profile              | âœ… Pass |
|                        | Get_all_profiles          | Lists all profiles                     | âœ… Pass |
|                        | Filter_profiles           | Filters by enriched email              | âœ… Pass |
|                        | Delete_profile            | Deletes profile and hierarchy          | âœ… Pass |
| `Test_UnificationRule` | Pre-requisite: Add_schema_attribute | Sets up enrichment rule for validation | âœ… Pass |
|                        | Add_unification_rule      | Adds a unification rule                | âœ… Pass |
|                        | Get_all_unification_rules | Lists rules                            | âœ… Pass |
|                        | Update_unification_rule   | Updates a rule                         | âœ… Pass |
|                        | Delete_unification_rule   | Removes rule                           | âœ… Pass |
| `Test_Consent` | Add_consent_category | Add consent category                   | âœ… Pass |
|                        | Get_all_consent_categories      | List consent categories                | âœ… Pass |
|                        | Get_single_category | Fetch single consent category          | âœ… Pass |
|                        | Update_consent_category   | Updates a consent category             | âœ… Pass |
|                        | Delete_consent_category   | Removes consent category                           
---

## ğŸ› ï¸ Tooling Reference

| Tool                | Purpose                                  |
|---------------------|-------------------------------------------|
| `gotestsum`         | Structured test runner with rich output   |
| `testcontainers-go` | Spin up ephemeral Postgres test DB        |
| `stretchr/testify`  | Assertions and suite support              |

---

## ğŸ§¹ Cleanup

To clean all build/test artifacts:

```bash
make clean
```

---

## âš ï¸ Notes

- Docker **must be running**.
- Tests modify DB state â€” run in isolation.
- Profile enrichment and unification happen **asynchronously** via queue workers â€” some tests include `sleep` or retry logic.

---
