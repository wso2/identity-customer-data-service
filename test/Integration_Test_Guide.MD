---
title: Integration Testing Guide
date: 2025-05-21
---

# ğŸ§ª Testing Guide â€” Identity Customer Data Service

This guide explains how to run, manage, and report integration tests in the `identity-customer-data-service` project using Go, Testcontainers, and standard tooling.

---

##  Prerequisites

1. **Install Go** (v1.20+ recommended)  
2. **Install Docker** (with CLI access)  

---

##  Test Directory Structure

```
/test
  â””â”€â”€ integration
      â”œâ”€â”€ enrichment_rules_test.go
      â”œâ”€â”€ events_test.go
      â”œâ”€â”€ profile_test.go
      â”œâ”€â”€ unification_rules_test.go
      â”œâ”€â”€ event_stream_id_test.go
      â”œâ”€â”€ setup/
      â”‚    â””â”€â”€ schema.sql
      â””â”€â”€ utils/
           â””â”€â”€ ...
```

---

##  Test Setup Overview

Tests use **Testcontainers-Go** to spin up a Postgres container and initialize the schema from `test/setup/schema.sql`.

- Containers are terminated explicitly at the end.
- `TESTCONTAINERS_RYUK_DISABLED=true` is used to avoid lifecycle issues.

---

## ğŸ§ª Running Tests

### Run All Tests

```bash
make integration-test
```

Logs are stored in:

```
target/integration-test.log
```

### Run a Specific Test

```bash
make integration-test test=Test_ProfilesService
```

---

## âœ… Test Suite Summary

| Test Suite             | Sub-Test Name             | Description                                       | Status  |
|------------------------|---------------------------|---------------------------------------------------|---------|
| `Test_EnrichmentRule`  | Add_enrichment_rule       | Adds profile enrichment rules                     | âœ… Pass |
|                        | Update_enrichment_rule    | Updates an enrichment rule                        | âœ… Pass |
|                        | Delete_enrichment_rule    | Deletes the enrichment rule                       | âœ… Pass |
| `Test_EventStreamId`   | Create_event_stream_Id    | Creates a new event stream ID                     | âœ… Pass |
|                        | Fetch_event_stream_Id_by_app | Retrieves by app/org                              | âœ… Pass |
|                        | Get_event_stream_Id_by_Id | Fetches by ID                                     | âœ… Pass |
|                        | Rotate_event_stream_Id    | Rotates the stream ID                             | âœ… Pass |
|                        | Revoke_event_stream_Id    | Revokes the stream ID                             | âœ… Pass |
| `Test_Events`          | Add_event                 | Ingests an event                                  | âœ… Pass |
|                        | Get_Profile               | Verifies profile linkage                          | âœ… Pass |
|                        | Get_event_by_ID           | Fetches event by ID                               | âœ… Pass |
|                        | Get_events_with_filters   | Filters events                                    | âœ… Pass |
| `Test_Profiles`        | Create_profile_via_event  | Creates profile from event ingestion              | âœ… Pass |
|                        | Fetch_created_profile     | Retrieves created profile                         | âœ… Pass |
|                        | Get_all_profiles          | Lists all profiles                                | âœ… Pass |
|                        | Filter_profiles           | Filters by enriched email                         | âœ… Pass |
|                        | Delete_profile            | Deletes profile and hierarchy                     | âœ… Pass |
| `Test_UnificationRule` | Pre-requisite: Add_enrichment_rule | Sets up enrichment rule for validation            | âœ… Pass |
|                        | Add_unification_rule      | Adds a unification rule                           | âœ… Pass |
|                        | Get_all_unification_rules | Lists rules                                       | âœ… Pass |
|                        | Update_unification_rule   | Updates a rule                                    | âœ… Pass |
|                        | Delete_unification_rule   | Removes rule                                      | âœ… Pass |

---

## ğŸ› ï¸ Tooling Reference

| Tool                | Purpose                                  |
|---------------------|-------------------------------------------|
| `gotestsum`         | Structured test runner with rich output   |
| `testcontainers-go` | Spin up ephemeral Postgres test DB        |
| `stretchr/testify`  | Assertions and suite support              |

---

## ğŸ§¹ Cleanup

To clean all build/test artifacts:

```bash
make clean
```

---

## âš ï¸ Notes

- Docker **must be running**.
- Tests modify DB state â€” run in isolation.
- Profile enrichment and unification happen **asynchronously** via queue workers â€” some tests include `sleep` or retry logic.

---
